<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">

    <title>Trump World</title>
    <script type="text/javascript" src="assets/js/jquery/dist/jquery.min.js"></script>
    <script src="assets/css/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="assets/css/bootstrap-material-design/dist/js/material.min.js"></script>    
    <script src="assets/css/bootstrap-material-design/dist/js/ripples.min.js"></script>
    <script type="text/javascript" src="assets/js/trump-world-preset.js"></script>
    <script type="text/javascript" src="assets/js/graph-styles.js"></script>
    <script type="text/javascript" src="assets/js/formatXml.js"></script>
    <script type="text/javascript" src="assets/js/cytoscape/dist/cytoscape.min.js"></script>
    <script type="text/javascript" src="assets/js/cytoscape-graphml/cytoscape-graphml.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="assets/js/maketable.js"></script>
    <script type="text/javascript" src="assets/js/graphDataView.js"></script>
    <script type="text/javascript" src="assets/js/slidereveal.js"></script>
    <script type="text/javascript" src="assets/js/jquery.qtip.min.js"></script>
    <link href="assets/css/jquery.qtip.min.css" rel="stylesheet" />
    <script type="text/javascript" src="assets/js/cytoscape-qtip.js"></script>
    <script type="text/javascript" src="assets/js/fastclick.min.js"></script>
    

    <link href="https://fonts.googleapis.com/css?family=Metrophobic" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="assets/css/mdi/css/materialdesignicons.min.css" media="all" rel="stylesheet" type="text/css" />
    <link href="assets/css/font-awesome-4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquery.qtip.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">
    <link href="assets/css/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" >
    <link href="assets/css/bootstrap-material-design/dist/css/bootstrap-material-design.css" rel="stylesheet" type="text/css" >
    <link href="assets/css/bootstrap-material-design/dist/css/ripples.min.css" rel="stylesheet" type="text/css" >

    
    <link href="assets/css/styles.css" rel="stylesheet" />

    <script type="text/javascript">
        $.material.init();
    </script>
    <script type="text/javascript" src="assets/js/typeahead.bundle.js"></script>
</head>

<body > 
    <div class="container-fluid">

        <row class="card" style="padding-top:10px;margin-bottom:10px;">
            <div class="col-md-3 col-lg-3 col-sm-3">
                <p class="title">The Trump World</p>
            </div>
            <div class="col-md-7 col-lg-7 col-sm-7">
                <a href="javascript:void(0)" class="btn active" id="graph_viz_btn">Network Viz</a>
                <a href="javascript:void(0)" class="btn " id="adj_matrix_btn">Adjacency Matrix</a>
                <a href="javascript:void(0)" class="btn " id="rankings_btn">Rankings</a>
                <a href="javascript:void(0)" class="btn " id="graph_data_btn">Data</a>
                <a href="javascript:void(0)" class="btn " id="help_btn">About</a>
            </div>
            <div class="col-md-2 col-lg-2 col-sm-2">
                <a href="javascript:void(0)" id="reset" class="btn btn-sm">
                    <i class="material-icons">aspect_ratio</i>
                </a>
                <a href="javascript:void(0)" id="refresh" class="btn btn-sm">
                    <i class="material-icons" >refresh</i>
                </a>
                <a href="javascript:void(0)" class="btn btn-danger btn-sm" id="trigger">
                    <i class="material-icons" >menu</i>
                </a> 
            </div>
        </row>

        <row >
            
            <div id="viz">
                <div id="left" class="card">
                    <div id="cy_container">
                        <div id="cy"></div>                        
                    </div>
                </div>
                <div id="right" >
                    <div id="path_info"></div>
                    <div id="node_info" class="card">

                        <!-- <div class="card-height-indicator"></div> -->

                        <div class="card-content">

                            <div class="card-body">
                                <div class="card-body-header"></div>
                                <div class="card-body-content"></div>
                            </div>

                            <footer class="card-footer">                                
                            </footer>

                        </div>

                    </div>
                    <div id="graph_legends">
                        Graph Legend Info needs to be here
                    </div> 
                </div> 
            </div>
                                 
            <div id="adj_matrix_container">
                <div id="adj_matrix">
                    <!-- <iframe src="adjacencyMatrix.html" style="width:100%;height:100%;overflow: scroll; border: none;"></iframe> -->                            
                </div>
            </div>

            <div id="rankings_container" >
                <div id="rankings" class="card">
                    
                </div>
            </div>

            <div id="graph_data_container" class="container ">
                <div class="card">
                    <ul class="list-group" style="margin:20px;">
                        <li class="list-group-item ">
                            <a href="#per_per" class="btn btn-info btn-flat btn-block " style="border:1px solid rgb(3, 169, 244);text-align: left;" data-toggle="collapse">View Buzzfeed Data: Person to Person</a>
                            <div id="per_per" class="collapse"></div>
                        </li>
                        <li class="list-group-item ">
                            <a href="#per_org" class="btn btn-info btn-flat btn-block " style="border:1px solid rgb(3, 169, 244);text-align: left;" data-toggle="collapse">View Buzzfeed Data: Person to Organization</a>
                            <div id="per_org" class="collapse"></div>
                        </li>
                        <li class="list-group-item ">
                            <a href="#org_org" class="btn btn-info btn-flat btn-block " style="border:1px solid rgb(3, 169, 244);text-align: left;" data-toggle="collapse">View Buzzfeed Data: Organization to Organization</a>
                            <div id="org_org" class="collapse "></div>
                        </li>
                    </ul> 
                </div>
                <div class="card" style="margin-top:10px;margin-bottom:10px;padding:20px;">
                    <h2 class="heading"> GraphML: Buzzfeed, FEC Donors and Federal Contracts Data </h2>
                    <div id="graphml_data" style="padding-left:20px;border:1px solid #212121;height:400px; overflow-y: scroll;"></div>
                </div>
            </div>

            <div id="help_container" class="container">
                <div class="col-sm-10 card" style="padding:25px;">
                    <row>
                        <img src="assets/images/wsj-trump-500.jpg" style="height: 400px;width: 90%;margin-left:90px;">
                        <cite class="col-sm-12" style="text-align: right">Credit: <a href="http://www.storybench.org/how-the-wall-street-journal-visualized-the-500-conflicts-of-interest-of-the-trumps/" target="_blank">The Storybench</a></cite>
                    </row>
                    <row>
                        <center><h1 class="title"> Mapping the Trump World </h1></center>
                    </row>
                    <row>
                          <h3 class="heading">Data Sources</h3>
                         
                           <p>This data set was largely compiled from the <a class="" href="https://github.com/BuzzFeedNews/trumpworld">Buzzfeed Trumpworld Dataset</a>.  This dataset contains relationships between people and organizations in the Trump network, as found in legal filings and news articles. Each element, or node, in that data set has an accompanying reference for where that relationship was identified, and are displayed in the "Search" and "Learn More About" results.</p>
                            
                           <p>We further enriched the Buzzfeed data by adding in 3 other sources - we'd love to get to more! This was inspired by and heavily leveraged the great work that the Neo4j community has contributed, and can all be found at the <a href="https://github.com/neo4j-contrib/trumpworld-graph">Neo4j Trumpworld Github</a>.   </p>
                        
                           <p>First, we matched the companies in the Buzzfeed dataset against all <a href="https://www.usaspending.gov/DownloadCenter/Pages/DataDownload.aspx">US Federal Contracts</a> that were awarded in 2016.  This identified companies in the network that were awarded contracts, and created a connection between the awarding federal agency and the company.  </p>
                        
                           <p>Next, we joined all of the people and organizations in the dataset against information found in <a href="https://www.littlesis.org">LittleSis.org</a>.  LittleSis is a watchdog organization which doucments relationsihps between powerful individuals and orgnaizations. This added hundreds of connections to our original network. </p>
                        
                           <p>Finally, we merged in all of the nominees for President Trump's administration positions, as documented in the Tracker Database of the Washington Post.  This data is current as of Feb 18, 2017.  This again created new relationships between people and the federal aganecies that they were nominated to work at.</p>
                            
                            <p> All data was loaded and merged using <a href="https://neo4j.com/product/">Neo4j community edition</a>, exported into a graphML file, manipulated into JSON and built using <a href = "http://js.cytoscape.org/">cytoscape.js</a>.
                            </p>                           
                          

                          <h3 class="heading">Goals</h3>
                            <ul>
                              <li>Create a searchable network,</li>
                              <li>Help journalists and curious citizens with their research,</li>
                              <li>Allow exploration of complex relationships between the many businesses, federal agencies and associates in the Trump network</li>
                            </ul>  

                          <h3 class="heading">Authors</h3>        
                           <p>This website was created by Sharmila Velamur <a href="mailto:sharmila.velamur@berkeley.eduSubject=Trumpworld" target="_top">(sharmila.velamur@berkeley.edu)</a> and Chandler McCann <a href="mailto:chandler.mccann@berkeley.eduSubject=Trumpworld" target="_top">(chandler.mccann@berkeley.edu)</a> as their class project for <a href="https://www.ischool.berkeley.edu/courses/datasci/209">W209 Data Visualization and Communication</a> at <a href="https://datascience.berkeley.edu/">The University of California, Berkeley Data Science Program</a>. </p>                                
                        </row>
                        
                </div>
                <div class="col-sm-10 card" style="margin-top:15px;margin-bottom:10px;">
                        <h3 class="heading-sm">An Important Aside About Social Network Analysis</h3>
                        <p>Social network analysis is very interesting, and this one is no different.  We use multiple measures of centrality, or types of influence nodes have, throughout this site.  This analysis is limited by the total information in the network as well as it's accuracy.  Adding or removing even one node can significantly alter network measures.  This does not mean to ignore the analysis, however, but do keep in mind that this representation of the Trump Network, while vast(>8000 nodes and >11,000 edges) is incomplete.  Interesting patterns do arise, and we encourage you to add more nodes to the network via the Buzzfeed data set by emailing trump@buzzfeed.com. </p>
                </div>
            </div>
        </div>
    </row>
    <div id="slider" class="card" style="padding-top:40px;">
        <div style="height:80px">
            <div class="col-md-2 col-lg-2 col-sm-2">
                <i class="material-icons icon">search</i>
            </div>
            <div id="search">
                <div class="col-md-5 col-lg-5 col-sm-5">
                    <div class="form-group label-static">
                        <label for="startNode" class="control-label" >Start At</label>
                        <input type="text" class="form-control typeahead" id="startNode">
                    </div>
                </div>

                <div class="col-md-5 col-lg-5 col-sm-5">
                    <div class="form-group label-static search">
                        <label for="endNode" class="control-label">End At</label>
                        <input type="text" class="form-control typeahead" id="endNode" >
                    </div>
                </div>
            </div>
        </div>
        <div style="height:80px">
            <div class="col-md-2 col-lg-2 col-sm-2">
                <i class="material-icons icon">zoom_in</i>
            </div>
            <div class="col-md-9 col-lg-9 col-sm-9">
                <div class="form-group label-static">
                    <label for="focusOn" class="control-label">Learn More About</label>
                    <input type="text" class="form-control typeahead" id="focusOn" style="width: 100%">
                </div>
            </div>
        </div>
        <div style="height:80px">
            <div class="col-md-2 col-lg-2 col-sm-2">
                <i class="material-icons icon">adjust</i>
            </div>
            <div class="col-md-9 col-lg-9 col-sm-9">
                <div class="form-group label-static">
                    <label for="resizeNodes" class="control-label">Reprioritize Graph By</label>
                    <select id="resizeNodes" class="form-control">
                        <option value="">Select</option>
                        <option value="degree" selected="selected"> Most Connected (Degree) </option>
                        <option value="betweeness"> Most Paths (Betweeness) </option>
                        <option value="closeness"> Most Reach (Closeness) </option>
                        <option value="pagerank"> Most Popular (Pagerank) </option>
                    </select>
                </div>
            </div>
        </div>
        <div style="height:80px">
            <div class="col-md-2 col-lg-2 col-sm-2">
                <i class="material-icons icon">file_download</i>
            </div>
            <div class="col-md-9 col-lg-9 col-sm-9">
                <div class="form-group label-static ">
                    <label for="exportAs" class="control-label">Export As</label>
                    <select id="exportAs" class="form-control">
                        <option value="">Select</option>
                        <option value="png"> PNG </option>
                        <option value="svg"> SVG </option>
                        <option value="graphml"> GraphML </option>
                    </select>
                </div>
            </div>
        </div>
        <div style="height:80px">
            <div class="col-md-2 col-lg-2 col-sm-2">
                <i class="material-icons icon" style="margin-top:40px;">filter_list</i>
            </div>
            <div class="col-md-10 col-lg-10 col-sm-10">
                <div id="filters" class="form-group" style="margin-top: 2px;">
                    <div style="display:block">
                        <input name="personNode" id="personNode" type="checkbox" />
                        <label for="personNode" class="control-label">  
                            Person
                        </label>
                    </div>
                    <div style="display:block">
                        <input name="orgNode" id="orgNode" type="checkbox" />
                        <label for="orgNode" class="control-label">  
                            Organization
                        </label>
                    </div>
                    
                    <div style="display:block">
                        <input name="contractNode" id="contractNode" type="checkbox" />
                        <label for="contractNode" class="control-label"> Contract </label>
                    </div>
                    <div style="display:block">
                         
                        <input name="agencyNode" id="agencyNode" type="checkbox" />
                        <label for="agencyNode" class="control-label"> Agency </label>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loading">
        <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
        <div>Loading: Trump Network Data </div>
    </div>

    <script type="text/javascript">
        var win = $(window);
        
        //Create D3 JSON Object Array for Rankings

        var graphElementsRankingsD3 = [];

        $(function() {          

            "use strict";

            var nodeIndex = 0;

            graphElements.forEach(c => { 

                if (!c.data["source"]) {

                    graphElementsRankingsD3.push({
                        "ID": c.data["id"],
                        "Type": c.data["label"],
                        "Name": (c.data["label"] === "Contract") ? ('PIID: ' + c.data["piid"]) : c.data["name"],
                        "Degree": c.data["dcn"].toFixed(3),
                        "Closeness": c.data["ccn"].toFixed(3),
                        "Betweeness": c.data["bc"].toFixed(3),
                        "Pagerank": c.data["pr"].toFixed(4)
                    });
                } 
            });

  

            var cy = window.cy = cytoscape({
                headless: false,
                styleEnabled: true,
                pixelRatio: 1,
                container: $("#cy"),
                elements: graphElements,
                style: graphStyles,
                layout: {
                    name: 'preset'
                },                  
                motionBlur: true,
                zoomingEnabled: true,
                userZoomingEnabled: true,
                panningEnabled: true,
                userPanningEnabled: true,
                boxSelectionEnabled: true,
                selectionType: 'single',
                touchTapThreshold: 8,
                desktopTapThreshold: 4,
                autolock: false,
                autoungrabify: false,
                autounselectify: false,
                hideEdgesOnViewport: true,
                textureOnViewport: true,
                ready: function() {
                    $("#cy_container").height(win.innerHeight() - 130);
                    $("#right").height(win.innerHeight() - 130);
                    this.resize();
                    this.zoom(0.1);
                    let initNode = this.$('[name="IVANKA TRUMP"]');
                    this.fit(initNode.openNeighbourhood(), 10);                        

                    $('#graph_legends').show();
                    $('#path_info').hide();
                    $('#node_info').hide();
 

                    this.elements().qtip({
                        content: {
                            title: function() { return this.data("label"); },
                            text: function() { 
                                let x = (this.data("name") === undefined) ? '' : $.camelCase(this.data("name"));
                                x += (this.data("purpose") === undefined) ? '' : $.camelCase(this.data("purpose"));
                                return x; 
                            }                                                              
                        },
                        show: {
                          event: 'mouseover'
                        },
                        hide: {
                            event: 'mouseout'
                        },
                        position: {
                            my: 'top center',
                            at: 'bottom center'
                        },
                        style: {
                            classes: 'qtip-bootstrap',
                            tip: {
                                width: 16,
                                height: 8
                            },
                            'font-size': '8px'
                        }
                    });
                    $('#loading').addClass('loaded');
                    // $("#graph_viz_btn").addClass('activeButton');
                } 

            }); //end cy

            /**********************************************************************/
            /*  CENTER AND RESET ZOOM OF THE VIEW PORT                            */
            /**********************************************************************/
            $("#reset").on('click', function() {
                cy.batch(function() { 
                    cy.fit(cy.elements());
                });
                
            }); 

            /**********************************************************************/
            /*  REMOVE CSS CLASSES AND SPECIAL STYLES; RESTORE ORG POSITIONS      */
            /**********************************************************************/
            var clear = function() {
                cy.batch(function() { 
                    cy.elements().removeClass('path not-path focus focus-neighbour start end hidden faded highlighted');
                });
                $('#graph_legends').show();
                $('#path_info').hide();
                $('#node_info').hide();
            }

            $("#refresh").on('click', function() {
                clear();
            });         

            

            /**********************************************************************************/
            /*          BOOTSTRAP CY DIV FIX                                                  */
            /**********************************************************************************/
            var resize = function() {
                $("#right").height(win.innerHeight());
                $("#left").height(win.innerHeight());
                $("#cy_container").height(win.innerHeight() - 130);
                cy.resize();
            };

            win.resize(function() {
                resize();
            });

            var displayNodeInfo = function(focusOn) {
                //Contract type nodes are special cases
                //They connect to an organization (issued contract)
                //They connect to an agency (awarded contract)
                //There are no other connections possible - for eg: contract to person does not exist
                //Also, one contract is related to one organization and one agency only
                let nodeHeaderName = focusOn.data('name');
                let connectionsColumns = ['Has Relationship', 'With', 'Source'];
                let connectionsData = [];
                let sourceType = focusOn.data('label');

                if (sourceType  === 'Contract') {
                    nodeHeaderName = 'PIID: ' + focusOn.data('piid');
                }                
                
                focusOn.connectedEdges().forEach(d => { 
                    let nextNode = null;
                    if (sourceType  === 'Contract') {
                        nextNode = d.source();        
                    } else {
                        nextNode = d.target();
                    }

                    let targetType = nextNode.data('label').trim();
                    let targetName = targetType === 'Contract' 
                                            ? 'PIID:' + nextNode.data('piid').trim() 
                                                      + ' - ' 
                                                      + nextNode.data('purpose').trim() 
                                                      + ', for $' 
                                                      + nextNode.data('amount').trim()
                                            : nextNode.data('name').trim();

                    let connectedEntity = targetType + ': ' + targetName;                    

                    let hasRelationship = d.data('label');

                    let sourceInfo = '';
                    if (targetType === 'Contract') {
                        // Get the target node edges and find the source agency that awarded the contract
                        let contractNodeEdges = d.target().connectedEdges();
                        contractNodeEdges.forEach( c => {
                            if (c.source().data('label') === 'Agency') {
                                sourceInfo = 'Issued By: ' + c.source().data('name');
                            }
                        });

                    } else {

                        sourceInfo = d.data('fromSource') === undefined ? '' : d.data('fromSource').trim();        
                        
                    }                          

                    connectionsData.push({
                        'Has Relationship': hasRelationship,
                        'With': connectedEntity,                        
                        'Source': sourceInfo
                    }); 
                    
                });

                $('#node_info .card-body .card-body-header').html('<h4> ' +  nodeHeaderName + ' (' + focusOn.data('label') + ')</h4>');
                tabulate("#node_info .card-body .card-body-content", connectionsData, connectionsColumns); 
                $('#node_info').show(); 
            }

            /**********************************************************************/
            /*  USER INTERACTION BASED EVENT LISTENERS                            */
            /**********************************************************************/
            cy.on('click', 'node', function( evt ){
                var focusOn = evt.cyTarget;
                console.log(focusOn.data());
                $('#graph_legends').hide();
                $('#path_info').hide();
                $('#node_info .card-body .card-body-header').html('');
                $('#node_info .card-body .card-body-content').html('');
                
                displayNodeInfo(focusOn);
            });

            /**********************************************************************/
            /*  FOCUS ON NODE - PAN & ZOOM TO SAID NODE                           */
            /**********************************************************************/

            var substringMatcher = function(strs) {
                return function findMatches(q, cb) {
                    var matches, substrRegex;

                    // an array that will be populated with substring matches
                    matches = [];

                    // regex used to determine if a string contains the substring `q`
                    substrRegex = new RegExp(q, 'i');

                    // iterate through the pool of strings and for any string that
                    // contains the substring `q`, add it to the `matches` array
                    $.each(strs, function(i, str) {
                        if (substrRegex.test(str)) {
                            matches.push(str);
                        }
                    });
                    cb(matches);
                };
            };

            var nodeNames = [];
            cy.nodes().forEach( n => {
                nodeNames.push(n.data("name"));
            });
            console.log(nodeNames[0]);

            $('.typeahead').typeahead({
              minLength: 3,
              highlight: false
            },
            {
              name: 'my-dataset',
              source: substringMatcher(nodeNames)
            });

            $('#focusOn').on('change', function(e){

                console.log("In focusOn: " + $('#focusOn').val());
                clear();
                $("#slider").slideReveal("hide");
                $('#graph_legends').hide();
                $('#path_info').hide();                

                let focusOn = cy.$("[name = '" + $("#focusOn").val().toUpperCase() + "']");
                let pos = focusOn.renderedPosition();
                  
                cy.elements().not( focusOn ).not( focusOn.neighbourhood() ).addClass('faded');                 
                focusOn.addClass('focus');
                focusOn.neighbourhood().addClass('focus-neighbour');
                
                cy.animate({
                    fit: {
                        eles: focusOn.neighbourhood(),
                        padding: 10
                    },
                    duration: 700,
                    easing: 'ease',
                    queue: true
                });
                
                displayNodeInfo(focusOn);       

            }); //end focus on

            /**********************************************************************/
            /*      FILTER OUT NODE TYPES CHOSEN BY THE USER                      */
            /**********************************************************************/
            $("#filters").on('change', function() {
                var noOrg         = !$("#orgNode").is(':checked');
                var noPerson      = !$("#personNode").is(':checked');
                var noAgency      = !$("#agencyNode").is(':checked');
                // var noCountry     = !$("#countryNode").is(':checked');
                var noContract    = !$("#contractNode").is(':checked');
                cy.batch (function() {
                    //clear();
                    $("#slider").slideReveal("hide");
                    // $('#graph_legends').show();
                    // $('#path_info').hide();
                    // $('#node_info').hide();
                    allNodes.forEach ( n => { 
                        var type = n.data("label");                            
                        n.removeClass('hidden');
                        var filter = function(){
                          n.addClass('hidden');
                        };
                        if (n.data("label") === "Organization" && !noOrg 
                            || n.data("label") === "Person" && !noPerson
                            || n.data("label") === "Agency" && !noAgency
                            || n.data("label") === "Contract" && !noContract) {
                            filter();
                        }
                    });

                });
            }); //end filter by

            /**********************************************************************************/
            /**     RESIZE NODES TO HIGHLIGHT DIFFERENT CENTRALITY MEASURES             *******/
            /**********************************************************************************/

            $('#resizeNodes').on('change', function() {
                console.log("In resizeNodes: " + $('#resizeNodes').val());
                $("#slider").slideReveal("hide");

                switch ($('#resizeNodes').val()) {
                    case 'betweeness': 
                        cy.startBatch();
                        cy.nodes().removeClass('ccn-resize pr-resize');
                        cy.nodes().addClass('bc-resize');
                        cy.endBatch();
                        break;
                    case 'closeness': 
                        cy.startBatch();
                        cy.nodes().removeClass('bc-resize pr-resize');
                        cy.nodes().addClass('ccn-resize');
                        cy.endBatch();
                        break;
                    case 'pagerank': 
                        cy.startBatch();
                        cy.nodes().removeClass('bc-resize pr-resize');
                        cy.nodes().addClass('ccn-resize');
                        cy.endBatch();
                        break;
                    default:
                        cy.startBatch();
                        cy.nodes().removeClass('bc-resize ccn-resize pr-resize');
                        cy.endBatch();
                }
            }); //end resize by

            /**********************************************************************************/
            /*  ASTAR IMPLEMENTATION -  FIND PATH TO GOAL NODE                              ***/
            /**********************************************************************************/ 
            $("#search").on('change', 'input', function() {

                if ($("#startNode").val() && $("#endNode").val()) {
                    clear();
                    $("#slider").slideReveal("hide");
                    $('#graph_legends').hide();
                    $('#path_info').hide();
                    $('#node_info').hide();
                    
                   
                    let start = cy.$("[name = '" + $("#startNode").val().toUpperCase() + "']");
                    let end = cy.$("[name = '" + $("#endNode").val().toUpperCase() + "']");

                    // calculate shortest path
                    cy.startBatch();
                    
                    start.addClass('start');
                    end.addClass('end');

                    setTimeout (function() {
                         var aStar = cy.elements().aStar({
                            root: start,
                            goal: end,
                            directed: false,
                            weight: function( e ) { 
                                return 1;
                            }
                        });                             
                        if ( !aStar.found ) {
                            clear();
                            cy.endBatch();
                            return;
                        } else {
                            
                            $("#path_info").html('');
                            $('#graph_legends').hide();                            
                            $('#node_info').hide();
                                           
                            cy.elements().not( aStar.path ).addClass('faded');    
                            aStar.path.addClass('path');
                            cy.animate({
                                fit: {
                                    eles: aStar.path,
                                    padding: 20
                                },
                                duration: 700,
                                easing: 'ease',
                                queue: true
                            });

                            let pathTableColumns = ['From', 'To', 'Relationship', 'Source'];
                            let pathTableData = [];
                            aStar.path.forEach(d => { 
                                let sourceName;
                                let sourceType;
                                let targetName;
                                let targetType;
                                let from;
                                let to;

                                let connectionType;
                                let moreInfo;
                                //Is this an edge or node?
                                if (d.source() && d.source().length > 0) {
                                    sourceName = d.source().data('name') === undefined ? '' : d.source().data('name').trim();
                                    sourceType = d.source().data('label') === undefined? '' : d.source().data('label').trim();
                                    from = sourceType + ', ' + sourceName;
                                    targetName = d.target().data('name') === undefined ? '' : d.target().data('name').trim();
                                    targetType = d.target().data('label') === undefined? '' : d.target().data('label').trim();
                                    to = targetType + ', ' + targetName;

                                    connectionType = d.data('connection') === undefined ? '' : d.data('connection');
                                    moreInfo = d.data('fromSource') === undefined ? '' : d.data('fromSource').trim();

                                    pathTableData.push({
                                        'From': from,
                                        'To': to,
                                        'Relationship': connectionType,
                                        'Source': moreInfo
                                    });

                                }  
                                
                            });

                            $("path_info").html('<h3> Shortest path from ' + $("#startNode").val() + 'to ' + $("#endNode").val() + ': </h3>');

                            tabulate("#path_info", pathTableData, pathTableColumns);
                            cy.endBatch();
                            $('#path_info').show();
                        }

                    }, 300);
                }
            }); //end search

            /**********************************************************************************/
            /*          NON-CY EVENTS                                              */
            /**********************************************************************************/

            /**********************************************************************************/
            /** RIGHT TO LEFT SLIDER - GRAPH ANALYSIS TOOLS                                  **/
            /**********************************************************************************/
            $('#slider').slideReveal({
                trigger: $("#trigger"),
                position: "right",
                width: "30%",
                top: 70,
                push: false,
                overlay: true,
                autoEscape: true,
                show: function() {
                    $("#slider input[type=text]").val('');
                    $("#exportAs").val('');
                }               
            });

            
            /**********************************************************************/
            /*      ON CLICK OF TRUMP WORLD SHOW CYTOSCAPE CONTAINER              */
            /**********************************************************************/

            $("#graph_viz_btn").click(function() {
                
                $("#viz").show();
                $("#trigger").show();
                $('#reset').show();
                $('#refresh').show();
                $("#adj_matrix_container").hide();
                $("#graph_data_container").hide();
                $("#help_container").hide();
                $("#rankings_container").hide();    
            });

            /**********************************************************************/
            /*       ON CLICK OF RANKINGS SHOW RANKINGS CONTAINER                **/
            /**********************************************************************/

            $("#rankings_btn").click(function() {
                
                $("#viz").hide();
                $("#trigger").hide();
                $('#reset').hide();
                $('#refresh').hide();
                $("#adj_matrix_container").hide();
                $("#graph_data_container").hide();
                $("#help_container").hide();
                $("#rankings_container").show();    
            });

            /**********************************************************************/
            /*       ON CLICK OF DESCRIPTION SHOW DESCRIPTION CONTAINER           */
            /**********************************************************************/

            $("#adj_matrix_btn").click(function() {
             
                $("#viz").hide();
                $("#trigger").hide();
                $('#reset').hide();
                $('#refresh').hide();
                $("#adj_matrix_container").show();
                $("#graph_data_container").hide();
                $("#help_container").hide();
                $("#rankings_container").hide();    
            });

            /**********************************************************************/
            /*       ON CLICK OF GRAPH DATA SHOW GRAPH DATA CONTAINER             */
            /**********************************************************************/

            $("#graph_data_btn").click(function() {
             
                $("#viz").hide();
                $("#trigger").hide();
                $('#reset').hide();
                $('#refresh').hide();
                $("#adj_matrix_container").hide();
                $("#graph_data_container").show();
                $("#help_container").hide();
                $("#rankings_container").hide();

            });

            /**********************************************************************/
            /*          ON CLICK OF HELP SHOW HELP CONTAINER                      */
            /**********************************************************************/

            $("#help_btn").click(function() {
                $("#viz").hide();
                $("#trigger").hide();
                $('#reset').hide();
                $('#refresh').hide();
                $("#adj_matrix_container").hide();
                $("#graph_data_container").hide();
                $("#help_container").show();
                $("#rankings_container").hide();    
            });

            /**********************************************************************/
            /*          QTIPS FOR REFRESH AND REFIT                               */
            /**********************************************************************/

            $("#refresh").qtip({
                content: {
                    text: "Clear Styles"
                },
                position: {
                    my: 'top center',
                    at: 'bottom center',
                    adjust: {
                        method: 'shift'
                    },
                    viewport: true
                },
                show: {
                  event: 'mouseover'
                },
                style: {
                    classes: 'qtip-bootstrap',
                    tip: {
                        width: 16,
                        height: 8
                    }
                }
            });

            $("#reset").qtip({
                content: {
                    text: "Fit Graph to Screen"
                },
                position: {
                    my: 'top center',
                    at: 'bottom center',
                    adjust: {
                        method: 'shift'
                    },
                    viewport: true
                },
                show: {
                  event: 'mouseover'
                },
                style: {
                    classes: 'qtip-bootstrap',
                    tip: {
                        width: 16,
                        height: 8
                    }
                }
            });

            var table_plot = makeTable()
              .datum(graphElementsRankingsD3)
              .sortBy('Degree', false);

            d3.select('#rankings').call(table_plot, true);

            table_plot.on('highlight', function(data, on_off){
              if(on_off){//if the data is highlighted
                d3.select('#highlighted').text(
                  //'Oops, I just stepped over gene ' + data.symb
                );
              }
            });
            table_plot.on('select', function(data, on_off){
              if(on_off){//if the data is highlighted
                d3.select('#selected').text(
                  'You chose ' + data.name
                );
              }
            });

            d3.csv('assets/data/org-org-connections.csv',function (data) {
                var columns = ['Organization A','Organization B','Connection','Source(s)']
                tabulate("#org_org", data, columns);
            });
            d3.csv('assets/data/person-person-connections.csv',function (data) {
                var columns = ['Person A','Person B','Connection','Source(s)']
                tabulate("#per_per", data, columns);
            });
            d3.csv('assets/data/person-org-connections.csv',function (data) {
                var columns = ['Organization','Person','Connection','Source(s)']
                tabulate("#per_org", data, columns);
            });
            d3.csv('assets/data/person-org-connections.csv',function (data) {
                var columns = ['Organization','Person','Connection','Source(s)']
                tabulate("#per_org", data, columns);
            });
            var graphP = $.ajax({
                url: 'assets/data/Trumpworld_CPM_20160401.graphml',
                type: 'GET',
                dataType: 'text'
            });
            Promise.all([graphP]).then(function (then) {
                let xmlFormatted = formatXml(then[0]);
                let xmlEscaped = xmlFormatted.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/ /g, '&nbsp;').replace(/\n/g,'<br />');
                $("#graphml_data").html(xmlEscaped);
            });
                   
        });

    </script>
</body>

</html>
